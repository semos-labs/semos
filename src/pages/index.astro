---
import Layout from "../layouts/Layout.astro";
import ProductCard from "../components/ProductCard.astro";
---

<Layout title="Semos Labs — Terminal, Reimagined">
  <!-- Hero -->
  <section class="min-h-screen flex flex-col md:flex-row items-center justify-center pt-28 md:pt-32 pb-16 px-8 gap-12 md:gap-16 max-w-content mx-auto text-center md:text-left">
    <div class="flex-1 max-w-full md:max-w-[560px]">
      <p class="text-[0.8rem] uppercase tracking-[0.2em] text-gray-400 mb-6">open source terminal tools</p>
      <h1 class="font-hand text-[1.6rem] md:text-[2.3rem] leading-[1.3] mb-6 tracking-[-0.02em]">
        The terminal deserves<br />
        <span class="text-gray-200 italic">beautiful software.</span>
      </h1>
      <p class="text-[0.95rem] text-gray-300 leading-[1.8] mb-10 max-w-full md:max-w-[460px]">
        Semos Labs builds a family of modern terminal applications and libraries.
        We believe the command line is not a limitation — it's a canvas.
      </p>
      <div>
        <a href="#products" class="btn-primary" data-ph-cta="hero_explore_products">Explore Products</a>
      </div>
    </div>
    <div class="flex-1 max-w-full md:max-w-[440px] w-full md:w-auto">
      <div class="bg-gray-900 border border-gray-700 rounded-xl overflow-hidden text-[0.82rem]">
        <div class="flex gap-1.5 px-4 py-3 bg-gray-800 border-b border-gray-700">
          <span class="w-2.5 h-2.5 rounded-full bg-gray-600"></span>
          <span class="w-2.5 h-2.5 rounded-full bg-gray-600"></span>
          <span class="w-2.5 h-2.5 rounded-full bg-gray-600"></span>
        </div>
        <div class="px-6 py-5 leading-[1.9] text-left">
          <p><span class="text-gray-400">$</span> <span class="text-white">bun create @semos-labs/glyph my-tui-app</span></p>
          <p class="text-gray-500">✓ Created project structure</p>
          <p class="text-gray-500">✓ Installed dependencies</p>
          <p class="text-gray-500">✓ Ready to build something great</p>
          <p>&nbsp;</p>
          <p><span class="text-gray-400">$</span> <span class="text-white">bun dev</span></p>
          <p class="text-gray-200">▸ Your TUI is alive ✨</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Why section -->
  <section class="py-24 px-8 border-t border-gray-800">
    <div class="max-w-content mx-auto">
      <h2 class="font-hand text-[2.2rem] md:text-[2.8rem] text-center mb-16">Why Semos?</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
        <div class="p-8 border border-gray-800 rounded-xl transition-colors hover:border-gray-600">
          <span class="block text-2xl mb-4 text-gray-300">⌘</span>
          <h3 class="font-hand text-2xl mb-3">Terminal-First</h3>
          <p class="text-[0.85rem] text-gray-400 leading-[1.7]">We live in the terminal. Our tools are built for developers who think in keystrokes, not clicks.</p>
        </div>
        <div class="p-8 border border-gray-800 rounded-xl transition-colors hover:border-gray-600">
          <span class="block text-2xl mb-4 text-gray-300">◎</span>
          <h3 class="font-hand text-2xl mb-3">React-Powered</h3>
          <p class="text-[0.85rem] text-gray-400 leading-[1.7]">Declarative components meet terminal rendering. Build TUIs the same way you build web apps.</p>
        </div>
        <div class="p-8 border border-gray-800 rounded-xl transition-colors hover:border-gray-600">
          <span class="block text-2xl mb-4 text-gray-300">△</span>
          <h3 class="font-hand text-2xl mb-3">One Ecosystem</h3>
          <p class="text-[0.85rem] text-gray-400 leading-[1.7]">Glyph powers everything. Aion and your next app — all share the same foundation.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Products -->
  <section class="py-24 px-8 border-t border-gray-800" id="products">
    <div class="max-w-content mx-auto">
      <h2 class="font-hand text-[2.2rem] md:text-[2.8rem] text-center mb-16">What We Build</h2>

      <ProductCard
        name="Glyph"
        logo="/logos/Glyph.png"
        repo="semos-labs/glyph"
        tagline="React renderer for the terminal"
        description="A terminal rendering engine that lets you build rich TUI applications using React components. Flexbox layouts, styling, focus management — everything you'd expect from a UI framework, running entirely in your terminal."
        tags={["React", "TypeScript", "Terminal", "Renderer"]}
        links={[
          { href: "/glyph", label: "Learn more →", cta: "glyph_learn_more" },
          { href: "https://github.com/semos-labs/glyph", label: "GitHub ↗", cta: "glyph_github", external: true },
          { href: "https://www.npmjs.com/package/@semos-labs/glyph", label: "npm ↗", cta: "glyph_npm", external: true },
        ]}
      />

      <ProductCard
        name="Aion"
        logo="/logos/Aion.png"
        repo="semos-labs/aion"
        tagline="Google Calendar in your terminal"
        description="A full-featured Google Calendar client that runs in your terminal. View, create, and manage events without leaving the command line. Built with Glyph for a smooth, responsive interface."
        tags={["Calendar", "Google API", "Glyph", "TUI"]}
        showDownloads
        downloadsHref="https://github.com/semos-labs/aion/releases"
        links={[
          { href: "/aion", label: "Learn more →", cta: "aion_learn_more" },
          { href: "https://github.com/semos-labs/aion", label: "GitHub ↗", cta: "aion_github", external: true },
        ]}
      />

      <ProductCard
        name="Epist"
        logo="/logos/Epist.png"
        repo="semos-labs/epist"
        tagline="Terminal email client with vim-style keybindings"
        description="A Gmail client that lives in your terminal. Two-column layout, thread view, search, attachments, calendar invites — all navigated with vim-style keybindings. Built with Glyph for a beautiful, responsive interface."
        tags={["Email", "Gmail", "Glyph", "TUI"]}
        showDownloads
        downloadsHref="https://github.com/semos-labs/epist/releases"
        links={[
          { href: "/epist", label: "Learn more →", cta: "epist_learn_more" },
          { href: "https://github.com/semos-labs/epist", label: "GitHub ↗", cta: "epist_github", external: true },
        ]}
      />
    </div>
  </section>

  <!-- Newsletter -->
  <section class="py-24 px-8 border-t border-gray-800">
    <div class="max-w-[520px] mx-auto text-center">
      <h2 class="font-hand text-[2.2rem] md:text-[2.8rem] mb-4">Stay in the loop</h2>
      <p class="text-[0.9rem] text-gray-400 leading-[1.7] mb-10">
        Get occasional updates on new releases, features, and tools we're building. No spam, unsubscribe anytime.
      </p>
      <div id="subscribe-form">
      <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul>
        <form
          action="https://app.kit.com/forms/9086412/subscriptions"
          method="post"
          class="flex gap-3 max-w-md mx-auto md:flex-row flex-col seva-form-formkit-form"
          data-sv-form="9086412"
          data-uid="9bc23479a3"
          data-format="inline"
          data-version="5"
        >
          <input
            type="email"
            name="email_address"
            placeholder="you@example.com"
            required
            class="flex-1 px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg font-mono text-[0.85rem] text-white placeholder-gray-500 outline-none focus:border-gray-400 transition-colors"
          />
          <button
            type="submit"
            class="px-6 py-3 bg-white text-black font-mono text-[0.85rem] font-medium rounded-lg border border-white hover:bg-gray-200 transition-colors cursor-pointer shrink-0"
            data-ph-cta="newsletter_subscribe"
          >
            Subscribe
          </button>
        </form>
        <p class="mt-4 text-[0.72rem] text-gray-600">
          Powered by <a href="https://kit.com" target="_blank" rel="noopener" class="text-gray-500 hover:text-gray-300 transition-colors">Kit</a>
        </p>
      </div>
      <div id="subscribe-success" class="hidden">
        <p class="text-[1.1rem] text-gray-200 mb-2">✓ You're in!</p>
        <p class="text-[0.85rem] text-gray-400">Check your inbox to confirm your subscription.</p>
      </div>
    </div>
  </section>
</Layout>

<script>
  async function fetchStars() {
    const badges = document.querySelectorAll('.stars-badge');
    for (const badge of badges) {
      const repo = badge.getAttribute('data-repo');
      if (!repo) continue;
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}`);
        if (!res.ok) continue;
        const data = await res.json();
        const count = badge.querySelector('.stars-count');
        if (count) count.textContent = data.stargazers_count?.toLocaleString() ?? '0';
        badge.classList.remove('hidden');
        badge.classList.add('inline-flex');
      } catch { /* silent fail — badge stays hidden */ }
    }
  }

  async function fetchDownloads() {
    const badges = document.querySelectorAll('.downloads-badge');
    for (const badge of badges) {
      const repo = badge.getAttribute('data-repo');
      if (!repo) continue;
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/releases`);
        if (!res.ok) continue;
        const releases = await res.json();
        const total = releases.reduce((sum: number, r: any) =>
          sum + r.assets.reduce((a: number, asset: any) => a + (asset.download_count || 0), 0), 0);
        const count = badge.querySelector('.dl-count');
        if (count) count.textContent = total.toLocaleString();
        badge.classList.remove('hidden');
        badge.classList.add('inline-flex');
      } catch { /* silent fail — badge stays hidden */ }
    }
  }

  // Newsletter form
  const form = document.querySelector('#subscribe-form form') as HTMLFormElement;
  const formWrap = document.getElementById('subscribe-form')!;
  const successEl = document.getElementById('subscribe-success')!;
  const submitBtn = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = new FormData(form).get('email_address') as string;
    if (!email) return;

    submitBtn.textContent = 'Sending…';
    submitBtn.classList.add('opacity-60', 'pointer-events-none');

    try {
      const res = await fetch(form.action, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email_address: email }),
      });
      if (res.ok) {
        formWrap.classList.add('hidden');
        successEl.classList.remove('hidden');
      } else {
        throw new Error('Failed');
      }
    } catch {
      // Fallback: submit the form normally so Kit handles it
      form.submit();
    }
  });

  fetchStars();
  fetchDownloads();
</script>
