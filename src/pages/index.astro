---
import Layout from "../layouts/Layout.astro";
import ProductCard from "../components/ProductCard.astro";
---

<Layout title="Semos Labs — Terminal, Reimagined">
  <script is:inline>
    (function(){
      var k='semos_hero_seen',t=7*24*60*60*1e3;
      try{var s=localStorage.getItem(k);if(!s||Date.now()-Number(s)>=t)document.documentElement.classList.add('hero-animate')}catch(e){}
    })();
  </script>
  <!-- Hero -->
  <section class="lg:min-h-screen flex items-center justify-center pt-20 pb-12 md:pt-24 md:pb-20 px-6 md:px-8">
    <div class="w-full max-w-[1280px] flex flex-col lg:flex-row items-center gap-8 lg:gap-16">
      <!-- Left: Text -->
      <div class="w-full lg:w-1/2 text-left">
        <!-- Prompt -->
        <p id="hero-prompt" class="text-body-lg text-gray-500 mb-4 md:mb-6 [.hero-animate_&]:opacity-0 [.hero-animate_&]:transition-opacity [.hero-animate_&]:duration-500">
          <span class="text-gray-400">$</span> semos --init
        </p>

        <!-- Heading with typewriter -->
        <h1 class="heading-display mb-0 min-h-[3.5rem] md:min-h-[7rem]">
          <span id="hero-line1" data-text="The terminal deserves">The terminal deserves</span><span id="hero-cursor" class="hidden [.hero-animate_&]:inline cursor-blink text-gray-400 text-title-sm md:text-heading-sm">█</span>
          <br />
          <span id="hero-line2" data-text="beautiful software." class="text-gray-300 italic">beautiful software.</span>
        </h1>

        <!-- Body (hidden until typewriter completes) -->
        <div id="hero-body" class="mt-6 md:mt-8 [.hero-animate_&]:opacity-0 [.hero-animate_&]:transition-opacity [.hero-animate_&]:duration-700">
          <p class="text-base text-gray-400 leading-copy mb-6 md:mb-10 max-w-[540px]">
            A constellation of open-source terminal applications and libraries. Built for
            developers who think in keystrokes, not clicks.
          </p>

          <!-- Product listing -->
          <div class="mb-6 md:mb-10">
            <p class="text-body-lg text-gray-500 mb-3">
              <span class="text-gray-400">$</span> ls ./tools
            </p>
            <div class="grid grid-cols-[auto_auto_1fr] gap-x-3 gap-y-2 text-body-lg pl-2">
              <a href="/glyph" class="text-white hover:text-gray-200 transition-colors">glyph</a>
              <span class="text-gray-600">—</span>
              <span class="text-gray-400">React renderer for terminal UIs</span>
              <a href="/aion" class="text-white hover:text-gray-200 transition-colors">aion</a>
              <span class="text-gray-600">—</span>
              <span class="text-gray-400">Calendar in your terminal</span>
              <a href="/epist" class="text-white hover:text-gray-200 transition-colors">epist</a>
              <span class="text-gray-600">—</span>
              <span class="text-gray-400">Email with vim-style keybindings</span>
            </div>
          </div>

          <!-- CTAs -->
          <div class="flex gap-4 items-center flex-wrap">
            <a href="#products" class="btn-primary" data-ph-cta="hero_explore_products">Explore Products</a>
            <a href="https://github.com/semos-labs" target="_blank" rel="noopener" class="btn-secondary" data-ph-cta="hero_github">GitHub ↗</a>
          </div>
        </div>
      </div>

      <!-- Right: Screenshot -->
      <div class="hidden lg:block lg:w-[55%] shrink-0">
        <div class="rounded-xl overflow-hidden border border-gray-700/60 shadow-[0_4px_40px_rgba(0,0,0,0.5)]">
          <!-- Window chrome -->
          <div class="flex items-center gap-2 px-4 py-2.5 bg-gray-800/80 border-b border-gray-700/60">
            <div class="flex gap-1.5">
              <span class="w-2.5 h-2.5 rounded-full bg-gray-600"></span>
              <span class="w-2.5 h-2.5 rounded-full bg-gray-600"></span>
              <span class="w-2.5 h-2.5 rounded-full bg-gray-600"></span>
            </div>
            <span class="ml-2 text-[0.7rem] text-gray-500 font-mono">awesome-dashboard</span>
          </div>
          <img src="/images/showcase.jpg" alt="Epist — Terminal email client" class="w-full block" />
        </div>
      </div>
    </div>
  </section>

  <!-- Philosophy -->
  <section class="py-24 px-8 border-t border-gray-800">
    <div class="max-w-[720px] mx-auto">
      <h2 class="heading-section text-center mb-10">
        The terminal is not a limitation.
      </h2>
      <div class="text-base text-gray-400 leading-prose space-y-6 text-center">
        <p>
          Most developer tools treat the terminal as an afterthought — a place for logs, not
          interfaces. We disagree. The terminal is the most powerful interface ever built: fast,
          composable, always available.
        </p>
        <p>
          Semos exists to prove that terminal software can be as beautiful and intuitive as anything
          with a GUI. No Electron. No browser. Just your terminal, reimagined.
        </p>
      </div>
    </div>
  </section>

  <!-- Principles -->
  <section class="py-24 px-8 border-t border-gray-800">
    <div class="max-w-[1280px] mx-auto">
      <h2 class="heading-section text-center mb-16">How We Build</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="p-7 border border-gray-800 rounded-xl transition-colors hover:border-gray-600 shadow-[0_2px_20px_rgba(0,0,0,0.4)]">
          <span class="block text-body-sm mb-3 text-gray-500 font-mono">01</span>
          <h3 class="font-hand text-title-sm mb-3 font-bold">Terminal-First</h3>
          <p class="text-body-sm text-gray-400 leading-body">We don't port web apps to the terminal. We build native terminal experiences from the ground up.</p>
        </div>
        <div class="p-7 border border-gray-800 rounded-xl transition-colors hover:border-gray-600 shadow-[0_2px_20px_rgba(0,0,0,0.4)]">
          <span class="block text-body-sm mb-3 text-gray-500 font-mono">02</span>
          <h3 class="font-hand text-title-sm mb-3 font-bold">Keyboard-Driven</h3>
          <p class="text-body-sm text-gray-400 leading-body">Every action has a keybind. Navigate, create, search — all without reaching for the mouse.</p>
        </div>
        <div class="p-7 border border-gray-800 rounded-xl transition-colors hover:border-gray-600 shadow-[0_2px_20px_rgba(0,0,0,0.4)]">
          <span class="block text-body-sm mb-3 text-gray-500 font-mono">03</span>
          <h3 class="font-hand text-title-sm mb-3 font-bold">Beautiful by Default</h3>
          <p class="text-body-sm text-gray-400 leading-body">Great UX isn't exclusive to GUIs. Color, layout, animation — all possible right in your terminal.</p>
        </div>
        <div class="p-7 border border-gray-800 rounded-xl transition-colors hover:border-gray-600 shadow-[0_2px_20px_rgba(0,0,0,0.4)]">
          <span class="block text-body-sm mb-3 text-gray-500 font-mono">04</span>
          <h3 class="font-hand text-title-sm mb-3 font-bold">Open Source</h3>
          <p class="text-body-sm text-gray-400 leading-body">Built in public, for the community. Every line of code is MIT licensed and open for contribution.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Ecosystem -->
  <section class="py-24 px-8 border-t border-gray-800">
    <div class="max-w-[720px] mx-auto text-center">
      <h2 class="heading-section mb-10">One Renderer, Infinite Possibilities</h2>
      <p class="text-base text-gray-400 leading-prose mb-14">
        Everything starts with <a href="/glyph" class="text-gray-200 border-b border-gray-600 hover:text-white hover:border-white transition-colors" data-ph-cta="ecosystem_glyph">Glyph</a> — a React renderer
        that turns your terminal into a canvas. Write components, use flexbox layouts, manage focus and input — just like
        building for the web, but for the CLI.
      </p>
      <!-- Visual: Glyph → Apps -->
      <div class="flex flex-col items-center gap-6">
        <a href="/glyph" class="flex items-center gap-4 py-4 px-8 border border-gray-700 rounded-xl bg-gray-900/50 hover:border-gray-500 transition-colors" data-ph-cta="ecosystem_glyph_card">
          <img src="/logos/Glyph.png" alt="Glyph" class="w-10 h-10 rounded-lg" />
          <div class="text-left">
            <span class="text-white text-body-lg font-bold">Glyph</span>
            <span class="text-gray-500 text-caption ml-2">— the foundation</span>
          </div>
        </a>
        <div class="text-gray-600 text-title select-none">↓</div>
        <div class="flex gap-4 flex-wrap justify-center">
          <a href="/aion" class="flex items-center gap-3 py-3 px-6 border border-gray-800 rounded-lg hover:border-gray-600 transition-colors" data-ph-cta="ecosystem_aion_card">
            <img src="/logos/Aion.png" alt="Aion" class="w-8 h-8 rounded-lg" />
            <span class="text-gray-300 text-body-sm">Aion</span>
          </a>
          <a href="/epist" class="flex items-center gap-3 py-3 px-6 border border-gray-800 rounded-lg hover:border-gray-600 transition-colors" data-ph-cta="ecosystem_epist_card">
            <img src="/logos/Epist.png" alt="Epist" class="w-8 h-8 rounded-lg" />
            <span class="text-gray-300 text-body-sm">Epist</span>
          </a>
          <div class="flex items-center gap-3 py-3 px-6 border border-dashed border-gray-700 rounded-lg">
            <span class="text-gray-600 text-body-sm">Your app →</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Built with Glyph (hidden until we have more logos) -->
  <!--
  <section class="py-20 px-8 border-t border-gray-800">
    <div class="max-w-content mx-auto text-center">
      <p class="text-label uppercase tracking-caps text-gray-500 mb-14">Built with Glyph</p>
      <div class="flex justify-center items-center gap-14 md:gap-20 flex-wrap">
        <a href="/aion" class="flex flex-col items-center gap-4 group" data-ph-cta="built_with_glyph_aion">
          <img src="/logos/Aion.png" alt="Aion" class="w-16 h-16 rounded-xl opacity-40 group-hover:opacity-100 transition-opacity" />
          <span class="text-body-sm text-gray-600 group-hover:text-gray-300 transition-colors">Aion</span>
        </a>
        <a href="/epist" class="flex flex-col items-center gap-4 group" data-ph-cta="built_with_glyph_epist">
          <img src="/logos/Epist.png" alt="Epist" class="w-16 h-16 rounded-xl opacity-40 group-hover:opacity-100 transition-opacity" />
          <span class="text-body-sm text-gray-600 group-hover:text-gray-300 transition-colors">Epist</span>
        </a>
      </div>
    </div>
  </section>
  -->

  <!-- Products -->
  <section class="py-24 px-8 border-t border-gray-800" id="products">
    <div class="max-w-content mx-auto">
      <p class="text-label uppercase tracking-caps text-gray-500 mb-3">Products</p>
      <p class="text-body-lg text-gray-500 mb-12">
        <span class="text-gray-400">$</span> semos list --detailed
      </p>

      <ProductCard
        name="Glyph"
        logo="/logos/Glyph.png"
        repo="semos-labs/glyph"
        tagline="React renderer for the terminal"
        description="A terminal rendering engine that lets you build rich TUI applications using React components. Flexbox layouts, styling, focus management — everything you'd expect from a UI framework, running entirely in your terminal."
        tags={["React", "TypeScript", "Terminal", "Renderer"]}
        links={[
          { href: "/glyph", label: "Learn more →", cta: "glyph_learn_more" },
          { href: "https://github.com/semos-labs/glyph", label: "GitHub ↗", cta: "glyph_github", external: true },
          { href: "https://www.npmjs.com/package/@semos-labs/glyph", label: "npm ↗", cta: "glyph_npm", external: true },
        ]}
      />

      <ProductCard
        name="Aion"
        logo="/logos/Aion.png"
        repo="semos-labs/aion"
        tagline="Calendar in your terminal"
        description="A full-featured calendar client that runs in your terminal. Google Calendar and CalDAV — view, create, and manage events without leaving the command line. Built with Glyph for a smooth, responsive interface."
        tags={["Calendar", "Google Calendar", "CalDAV", "Glyph", "TUI"]}
        showDownloads
        downloadsHref="https://github.com/semos-labs/aion/releases"
        links={[
          { href: "/aion", label: "Learn more →", cta: "aion_learn_more" },
          { href: "https://github.com/semos-labs/aion", label: "GitHub ↗", cta: "aion_github", external: true },
          { href: "/aion/privacy", label: "Privacy", cta: "aion_privacy" },
        ]}
      />

      <ProductCard
        name="Epist"
        logo="/logos/Epist.png"
        repo="semos-labs/epist"
        tagline="Terminal email client with vim-style keybindings"
        description="A terminal email client with Gmail and IMAP/SMTP support. Two-column layout, thread view, search, attachments, calendar invites — all navigated with vim-style keybindings. Built with Glyph for a beautiful, responsive interface."
        tags={["Email", "Gmail", "IMAP", "SMTP", "Glyph", "TUI"]}
        showDownloads
        downloadsHref="https://github.com/semos-labs/epist/releases"
        links={[
          { href: "/epist", label: "Learn more →", cta: "epist_learn_more" },
          { href: "https://github.com/semos-labs/epist", label: "GitHub ↗", cta: "epist_github", external: true },
          { href: "/epist/privacy", label: "Privacy", cta: "epist_privacy" },
        ]}
      />
    </div>
  </section>

  <!-- Newsletter -->
  <section class="py-24 px-8 border-t border-gray-800">
    <div class="max-w-[520px] mx-auto text-center">
      <h2 class="heading-section mb-4">Stay in the loop</h2>
      <p class="text-body-lg text-gray-400 leading-body mb-10">
        Get occasional updates on new releases, features, and tools we're building. No spam, unsubscribe anytime.
      </p>
      <div id="subscribe-form">
      <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul>
        <form
          action="https://app.kit.com/forms/9086412/subscriptions"
          method="post"
          class="flex gap-3 max-w-md mx-auto md:flex-row flex-col seva-form-formkit-form"
          data-sv-form="9086412"
          data-uid="9bc23479a3"
          data-format="inline"
          data-version="5"
        >
          <input
            type="email"
            name="email_address"
            placeholder="you@example.com"
            required
            class="flex-1 px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg font-mono text-body-sm text-white placeholder-gray-500 outline-none focus:border-gray-400 transition-colors"
          />
          <button
            type="submit"
            class="px-6 py-3 bg-white text-black font-mono text-body-sm font-medium rounded-lg border border-white hover:bg-gray-200 transition-colors cursor-pointer shrink-0"
            data-ph-cta="newsletter_subscribe"
          >
            Subscribe
          </button>
        </form>
        <p class="mt-4 text-fine text-gray-600">
          Powered by <a href="https://kit.com" target="_blank" rel="noopener" class="text-gray-500 hover:text-gray-300 transition-colors">Kit</a>
        </p>
      </div>
      <div id="subscribe-success" class="hidden">
        <p class="text-title-sm text-gray-200 mb-2">✓ You're in!</p>
        <p class="text-caption text-gray-400">Check your inbox to confirm your subscription.</p>
      </div>
    </div>
  </section>
</Layout>

<script>
  // === Typewriter Animation ===
  async function sleep(ms: number) {
    return new Promise(r => setTimeout(r, ms));
  }

  async function typeText(el: HTMLElement, text: string, cursor: HTMLElement, speed = 45) {
    el.textContent = '';
    el.after(cursor);
    for (const char of text) {
      el.textContent += char;
      await sleep(speed + Math.random() * 15);
    }
  }

  async function runTypewriter() {
    const line1 = document.getElementById('hero-line1');
    const line2 = document.getElementById('hero-line2');
    const cursor = document.getElementById('hero-cursor');
    const prompt = document.getElementById('hero-prompt');
    const body = document.getElementById('hero-body');

    if (!line1 || !line2 || !cursor || !prompt || !body) return;

    const text1 = line1.getAttribute('data-text') || '';
    const text2 = line2.getAttribute('data-text') || '';

    line1.textContent = '';
    line2.textContent = '';

    await sleep(200);
    prompt.style.opacity = '1';

    await sleep(250);
    await typeText(line1, text1, cursor, 25);
    await sleep(80);
    await typeText(line2, text2, cursor, 25);

    await sleep(150);
    body.style.opacity = '1';

    // Hide cursor after animation, mark as seen
    await sleep(700);
    cursor.style.display = 'none';
    try { localStorage.setItem('semos_hero_seen', String(Date.now())); } catch {};
  }

  // === GitHub Stars ===
  async function fetchStars() {
    const badges = document.querySelectorAll<HTMLElement>('.stars-badge');
    for (const badge of badges) {
      const repo = badge.getAttribute('data-repo');
      if (!repo) continue;
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}`);
        if (!res.ok) continue;
        const data = await res.json();
        const count = badge.querySelector('.stars-count');
        if (count) count.textContent = data.stargazers_count?.toLocaleString() ?? '0';
        badge.dataset.loaded = '';
      } catch { /* silent fail */ }
    }
  }

  // === Downloads ===
  async function fetchDownloads() {
    const badges = document.querySelectorAll<HTMLElement>('.downloads-badge');
    for (const badge of badges) {
      const repo = badge.getAttribute('data-repo');
      if (!repo) continue;
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/releases`);
        if (!res.ok) continue;
        const releases = await res.json();
        const total = releases.reduce((sum: number, r: any) =>
          sum + r.assets.reduce((a: number, asset: any) => a + (asset.download_count || 0), 0), 0);
        const count = badge.querySelector('.dl-count');
        if (count) count.textContent = total.toLocaleString();
        badge.dataset.loaded = '';
      } catch { /* silent fail */ }
    }
  }

  // === Latest Version ===
  async function fetchVersions() {
    const badges = document.querySelectorAll<HTMLElement>('.version-badge');
    for (const badge of badges) {
      const repo = badge.getAttribute('data-repo');
      if (!repo) continue;
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/releases/latest`);
        if (!res.ok) continue;
        const data = await res.json();
        const tag = data.tag_name;
        if (!tag) continue;
        const label = badge.querySelector('.version-tag');
        if (label) label.textContent = tag;
        badge.dataset.loaded = '';
      } catch { /* silent fail */ }
    }
  }

  // === Newsletter Form ===
  const form = document.querySelector('#subscribe-form form') as HTMLFormElement;
  const formWrap = document.getElementById('subscribe-form')!;
  const successEl = document.getElementById('subscribe-success')!;
  const submitBtn = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = new FormData(form).get('email_address') as string;
    if (!email) return;

    submitBtn.textContent = 'Sending…';
    submitBtn.classList.add('opacity-60', 'pointer-events-none');

    try {
      const res = await fetch(form.action, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email_address: email }),
      });
      if (res.ok) {
        formWrap.classList.add('hidden');
        successEl.classList.remove('hidden');
      } else {
        throw new Error('Failed');
      }
    } catch {
      form.submit();
    }
  });

  if (document.documentElement.classList.contains('hero-animate')) {
    runTypewriter();
  }
  fetchStars();
  fetchDownloads();
  fetchVersions();
</script>
